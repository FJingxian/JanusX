FROM ubuntu:22.04

ARG DEBIAN_FRONTEND=noninteractive

ARG GATK_VER="4.6.2.0"

RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates curl wget unzip git \
    tabix \
    python3 python3-pip python3-venv \
    openjdk-17-jre-headless \
    bwa samtools fastp \
 && ln -sf /usr/bin/python3 /usr/local/bin/python \
 && rm -rf /var/lib/apt/lists/*

RUN python3 -m pip install --no-cache-dir -U pip setuptools wheel

WORKDIR /opt
# https://github.com/broadinstitute/gatk.git
RUN mkdir -p /opt/gatk \
    && git clone https://github.com/broadinstitute/gatk.git /opt/gatk \
    && (cd /opt/gatk && ./gradlew bundle) \
    && rm -f /opt/gatk/gatk-${GATK_VER}.zip

ENV PATH="/opt/gatk/gatk-${GATK_VER}:$PATH"

WORKDIR /work

CMD ["/bin/bash"]